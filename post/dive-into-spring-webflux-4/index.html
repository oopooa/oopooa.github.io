<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="åº”ç”¨æµ‹è¯•ï¼Œè°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹ï¼ŒåŒºåˆ†å†·åºåˆ—å’Œçƒ­åºåˆ—"><title>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆå››ï¼‰</title>
<link rel=canonical href=https://opoa.top/post/dive-into-spring-webflux-4/><link rel=stylesheet href=/scss/style.min.8cc3582c9f0f18f9b8822e51cc0ccf8ed1ed77303ae856f22131df2343eac61c.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta property='og:title' content="å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆå››ï¼‰"><meta property='og:description' content="åº”ç”¨æµ‹è¯•ï¼Œè°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹ï¼ŒåŒºåˆ†å†·åºåˆ—å’Œçƒ­åºåˆ—"><meta property='og:url' content='https://opoa.top/post/dive-into-spring-webflux-4/'><meta property='og:site_name' content='Opoa'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Spring'><meta property='article:tag' content='Java'><meta property='article:tag' content='Spring Webflux'><meta property='article:published_time' content='2022-09-12T22:40:24+08:00'><meta property='article:modified_time' content='2022-09-12T22:40:24+08:00'><meta property='og:image' content='https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/pond-tea-rem.webp'><meta name=twitter:title content="å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆå››ï¼‰"><meta name=twitter:description content="åº”ç”¨æµ‹è¯•ï¼Œè°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹ï¼ŒåŒºåˆ†å†·åºåˆ—å’Œçƒ­åºåˆ—"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/pond-tea-rem.webp'><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-5TC51Z6DWN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5TC51Z6DWN")}</script><link rel=stylesheet href=https://npm.elemecdn.com/@highlightjs/cdn-assets@11.7.0/styles/atom-one-dark.min.css><script src=https://npm.elemecdn.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e)})})</script><style>:root{--sys-font-family:"HarmonyOS_Sans_SC_Medium", Georgia, -apple-system, 'Nimbus Roman No9 L', 'PingFang SC', 'Hiragino Sans GB', 'Noto Serif SC', 'Microsoft Yahei', 'WenQuanYi Micro Hei', 'ST Heiti', sans-serif;--code-font-family:"JetBrainsMono Regular", Menlo, Monaco, Consolas, "Courier New";--article-font-family:"HarmonyOS_Sans_SC_Medium", var(--base-font-family)}</style><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huc9522c74db490d479204dfcc8d873015_49072_300x0_resize_q75_h2_box_2.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Opoa</a></h1><h2 class=site-description>Nut ğŸ¤ª</h2></div></header><ol class=menu-social><li><a href=https://github.com/oopooa target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://space.bilibili.com/19315530 target=_blank title=Bilibili rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ | Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£ | Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢ | Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#æµ‹è¯•ä¸è°ƒè¯•>æµ‹è¯•ä¸è°ƒè¯•</a><ol><li><a href=#å¼€å¯è°ƒè¯•æ¨¡å¼>å¼€å¯è°ƒè¯•æ¨¡å¼</a></li><li><a href=#ä½¿ç”¨-checkpoint-å®šä½>ä½¿ç”¨ checkpoint() å®šä½</a></li></ol></li><li><a href=#è°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹>è°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹</a><ol><li><a href=#åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨>åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨</a></li><li><a href=#åˆ‡æ¢è°ƒåº¦å™¨>åˆ‡æ¢è°ƒåº¦å™¨</a></li><li><a href=#å¹¶è¡Œæ‰§è¡Œ>å¹¶è¡Œæ‰§è¡Œ</a></li></ol></li><li><a href=#hot-vs-cold>Hot vs Cold</a><ol><li><a href=#å†·åºåˆ—>å†·åºåˆ—</a></li><li><a href=#çƒ­åºåˆ—>çƒ­åºåˆ—</a><ol><li><a href=#share>share</a></li><li><a href=#cache>cache</a></li></ol></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/dive-into-spring-webflux-4/><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/pond-tea-rem.webp loading=lazy alt="Featured image of post å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆå››ï¼‰"></a></div><div class=article-details><header class=article-category><a href=/categories/tech/ style=background-color:#598dfa;color:#fff>æŠ€æœ¯</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/dive-into-spring-webflux-4/>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆå››ï¼‰</a></h2><h3 class=article-subtitle>åº”ç”¨æµ‹è¯•ï¼Œè°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹ï¼ŒåŒºåˆ†å†·åºåˆ—å’Œçƒ­åºåˆ—</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2022-09-12</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 9 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=æµ‹è¯•ä¸è°ƒè¯•>æµ‹è¯•ä¸è°ƒè¯•</h2><p>æ·»åŠ æµ‹è¯•éœ€è¦çš„ä¾èµ–ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>io.projectreactor<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>reactor-test<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.1.4.RELEASE<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>junit<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>junit<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>4.12<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œè°ƒè¯•é€šå¸¸éƒ½æ˜¯éå¸¸ç›´è§‚çš„ï¼šç›´æ¥çœ‹æ ˆè°ƒç”¨èƒ½å®šä½åˆ°é—®é¢˜ä½ç½®ï¼Œæ˜¯å¦è‡ªå·±ä»£ç å®ç°æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯è°ƒç”¨çš„ç¬¬ä¸‰æ–¹åº“æŠ¥é”™ç­‰ç­‰ã€‚</p><p>å“åº”å¼çš„å¼‚æ­¥ä»£ç æµ‹è¯•å’Œè°ƒè¯•èµ·æ¥ä¼šæ¯”å‘½ä»¤å¼ç¼–ç¨‹éº»çƒ¦çš„å¤šï¼Œä¸è¿‡æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªåŸºæœ¬çš„å•å…ƒæµ‹è¯•å·¥å…· â€”â€”
<code>StepVerifier</code>ã€‚</p><p>å½“æµ‹è¯•æ—¶å…³æ³¨äºæ¯ä¸€ä¸ªæ•°æ®å…ƒç´ çš„æ—¶å€™ï¼Œå°±éå¸¸é€‚åˆ <code>StepVerifier</code> çš„ä½¿ç”¨åœºæ™¯ï¼šä¸‹ä¸€ä¸ªæœŸæœ›çš„æ•°æ®æˆ–ä¿¡å·æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦æƒ³è¦æŸä¸€ä¸ªç‰¹åˆ«çš„å€¼ç­‰ç­‰ã€‚</p><p>ä»¥å‘å‡º 1-6 çš„ <code>Flux</code> ä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=nf>generateFlux</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testVerify</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StepVerifier</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>generateFlux</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>expectNext</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>expectComplete</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>verify</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>expectNext</code> ç”¨äºæµ‹è¯•ä¸‹ä¸€ä¸ªæœŸæœ›çš„æ•°æ®å…ƒç´ ã€‚</li><li><code>expectComplete</code> ç”¨äºæµ‹è¯•ä¸‹ä¸€ä¸ªå…ƒç´ æ˜¯å¦ä¸ºå®Œæˆä¿¡å·ã€‚</li></ul><p>ä»¥ä¸€ä¸ªé”™è¯¯çš„æ•°æ®æµä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span><span class=w> </span><span class=nf>generateError</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Mono</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;some error&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testVerify</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StepVerifier</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>generateError</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>expectErrorMessage</span><span class=p>(</span><span class=s>&#34;some error&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>verify</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ul><li><code>expectErrorMessage</code> ç”¨äºæµ‹è¯•æ˜¯å¦æœ‰æŒ‡å®šä¿¡æ¯çš„å¼‚å¸¸ä¿¡å·ã€‚</li></ul><p>å¯¹äºç»ˆæ­¢äº‹ä»¶ï¼Œç›¸åº”çš„æœŸæœ›æ–¹æ³•ï¼ˆæ¯”å¦‚ <code>expectComplete()</code>ã€<code>expectError()</code>ï¼ŒåŠå…¶æ‰€æœ‰çš„å˜ä½“æ–¹æ³•ï¼‰ä½¿ç”¨ä¹‹åå°±ä¸èƒ½å†ç»§ç»­å¢åŠ åˆ«çš„æœŸæœ›æ–¹æ³•ï¼Œæœ€ååªèƒ½å¯¹ <code>StepVerifier</code> è§¦å‘æ ¡éªŒï¼ˆ<code>verify()</code>ï¼‰ã€‚</p><p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>Mono</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getMonoWithException</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>single</span><span class=p>();</span><span class=w> </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol><li><code>single</code> æ–¹æ³•å¿…é¡»ä¸”åªèƒ½æ¥æ”¶ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰å’Œå¤šäº†éƒ½ä¼šå¯¼è‡´å¼‚å¸¸ã€‚</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testBug</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>getMonoWithException</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è¿è¡Œç”¨ä¾‹ï¼Œå¼‚å¸¸ä¿¡æ¯ï¼š</p><p><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/spring-webflux-test-case1.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/spring-webflux-test-case1.webp alt=spring-webflux-test-case></a></div></p><p>èƒ½çœ‹åˆ°å¼‚å¸¸å†…å®¹å¤§éƒ¨åˆ†éƒ½æ˜¯ Reactor åº“å†…éƒ¨çš„è°ƒç”¨ï¼Œä¸Šè¾¹ stack trace çš„é—®é¢˜è¿˜æ˜¯å‡ºè‡ª <code>.subcribe()</code> é‚£ä¸€è¡Œã€‚
åœ¨å‘½ä»¤å¼ç¼–ç¨‹çš„æ–¹å¼ä¸­æ¯”è¾ƒå®¹æ˜“ä½¿ç”¨ IDEA çš„å·¥å…·è¿›è¡Œè°ƒè¯•ï¼Œä½†åœ¨å¼‚æ­¥ç¼–ç¨‹æ–¹å¼ä¸‹ï¼Œå°±ä¸å¤ªå¥½ä½¿äº†ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—ä½¿ç”¨å“åº”å¼ç¼–ç¨‹åº“æœ¬èº«æä¾›çš„è°ƒè¯•å·¥å…·ã€‚</p><h3 id=å¼€å¯è°ƒè¯•æ¨¡å¼>å¼€å¯è°ƒè¯•æ¨¡å¼</h3><blockquote><p>Hooks.onOperatorDebug();</p></blockquote><p>è°ƒè¯•æ¨¡å¼èƒ½åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶æ‰“å°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼ŒæŠŠè¿™ä¸€è¡ŒåŠ ä¸Šï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testBug</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Hooks</span><span class=p>.</span><span class=na>onOperatorDebug</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>getMonoWithException</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è¿™æ—¶å†è¿è¡Œï¼Œå¢åŠ äº†ä»¥ä¸‹å†…å®¹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:
</span></span><span class=line><span class=cl>Assembly trace from producer [reactor.core.publisher.MonoSingle] :
</span></span><span class=line><span class=cl>	reactor.core.publisher.Flux.single(Flux.java:7989)
</span></span><span class=line><span class=cl>	com.opoa.WebfluxTest.getMonoWithException(WebfluxTest.java:21)
</span></span><span class=line><span class=cl>Error has been observed at the following site(s):
</span></span><span class=line><span class=cl>	*__Flux.single â‡¢ at com.opoa.WebfluxTest.getMonoWithException(WebfluxTest.java:21)
</span></span></code></pre></div><p>è¿™æ ·å°±èƒ½å®šä½åˆ°é—®é¢˜æ ¹æºã€‚</p><p><code>Hooks.onOperatorDebug()</code> æ˜¯ä¸€ç§å…¨å±€æ€§çš„ Hookï¼Œä¼šå½±å“åˆ°åº”ç”¨ä¸­æ‰€æœ‰çš„æ“ä½œç¬¦ï¼Œæ‰€ä»¥å¸¦æ¥çš„æ€§èƒ½æˆæœ¬ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ã€‚å¦‚æœæˆ‘ä»¬å¤§æ¦‚çŸ¥é“é—®é¢˜å¯èƒ½åœ¨å“ªï¼Œè€Œå¯¹æ•´ä¸ªåº”ç”¨å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œä¹Ÿå®¹æ˜“è¢«èŒ«èŒ«å¤šçš„è°ƒè¯•ä¿¡æ¯æ·¹æ²¡ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´ç²¾å‡†çš„å®šä½æ–¹å¼ã€‚</p><h3 id=ä½¿ç”¨-checkpoint-å®šä½>ä½¿ç”¨ checkpoint() å®šä½</h3><p>å¦‚æœæˆ‘ä»¬çŸ¥é“é—®é¢˜å‡ºåœ¨å“ªä¸ªé“¾ä¸Šï¼Œå°±å¯ä»¥é’ˆå¯¹è¿™ä¸ªé“¾ä½¿ç”¨ <code>checkpoint()</code> è¿›è¡Œé—®é¢˜å®šä½ã€‚
<code>checkpoint()</code> æ“ä½œç¬¦å°±åƒä¸€ä¸ª Hookï¼Œä½†å®ƒçš„ä½œç”¨èŒƒå›´ä»…é™äºè¿™ä¸ªé“¾ä¸Šã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testBug</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>getMonoWithException</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>checkpoint</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>å‡ºç°å¼‚å¸¸æ—¶ä»ç„¶å¯ä»¥æ‰“å°å‡ºè°ƒè¯•ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>	Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException:
</span></span><span class=line><span class=cl>Assembly trace from producer [reactor.core.publisher.MonoSingle] :
</span></span><span class=line><span class=cl>	reactor.core.publisher.Mono.checkpoint(Mono.java:2177)
</span></span><span class=line><span class=cl>	com.opoa.WebfluxTest.testBug(WebfluxTest.java:27)
</span></span><span class=line><span class=cl>Error has been observed at the following site(s):
</span></span><span class=line><span class=cl>	*__checkpoint() â‡¢ at com.opoa.WebfluxTest.testBug(WebfluxTest.java:27)
</span></span></code></pre></div><br><h2 id=è°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹>è°ƒåº¦å™¨ä¸çº¿ç¨‹æ¨¡å‹</h2><p>åœ¨ä»¥å¾€çš„å¤šçº¿ç¨‹å¼€æ”¾åœºæ™¯ä¸­ï¼Œä½¿ç”¨ <code>Executors</code> å¯ä»¥åˆ›å»ºå››ç§çº¿ç¨‹æ± ï¼š</p><ul><li><code>newCachedThreadPool</code> åˆ›å»ºä¸€ä¸ªå¼¹æ€§å¤§å°ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹ï¼›</li><li><code>newFixedThreadPool</code> åˆ›å»ºä¸€ä¸ªå¤§å°å›ºå®šçš„çº¿ç¨‹æ± ï¼Œå¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼Œè¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼›</li><li><code>newScheduledThreadPool</code> åˆ›å»ºä¸€ä¸ªå¤§å°å›ºå®šçš„çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§çš„ä»»åŠ¡æ‰§è¡Œï¼›</li><li><code>newSingleThreadExecutor</code> åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œã€‚</li></ul><p>Reactor è®©çº¿ç¨‹ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦æ›´åŠ ç®€å• â€”â€” <strong>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</strong> å¸®æˆ‘ä»¬æå®šè¿™ä»¶äº‹ã€‚
<code>Scheduler</code> æ˜¯ä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªå®ç°ç±»çš„æŠ½è±¡æ¥å£ã€‚<code>Schedulers</code> ç±»æä¾›çš„é™æ€æ–¹æ³•å¯ä»¥æ­å»ºä»¥ä¸‹å‡ ç§çº¿ç¨‹æ‰§è¡Œç¯å¢ƒï¼š</p><ul><li>å½“å‰çº¿ç¨‹ï¼ˆ<code>Schedulers.immediate()</code>ï¼‰ï¼›</li><li>å¯é‡ç”¨çš„å•çº¿ç¨‹ï¼ˆ<code>Schedulers.single()</code>ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•å¯¹æ‰€æœ‰è°ƒç”¨è€…éƒ½æä¾›åŒä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œç›´åˆ°è¯¥è°ƒåº¦å™¨è¢«åºŸå¼ƒã€‚å¦‚æœæƒ³ä½¿ç”¨ç‹¬å çš„çº¿ç¨‹ï¼Œè¯·ä½¿ç”¨ <code>Schedulers.newSingle()</code>ï¼›</li><li>å¼¹æ€§çº¿ç¨‹æ± ï¼ˆ<code>Schedulers.elastic()</code>ï¼‰ã€‚å®ƒæ ¹æ®éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œé‡ç”¨ç©ºé—²çº¿ç¨‹ã€‚çº¿ç¨‹å¦‚æœç©ºé—²æ—¶é—´è¿‡é•¿ï¼ˆé»˜è®¤ä¸º 60sï¼‰å°±ä¼šè¢«é”€æ¯ã€‚å¯¹äº I/O é˜»å¡çš„åœºæ™¯æ¯”è¾ƒé€‚ç”¨ã€‚<code>Schedulers.elastic()</code> èƒ½å¤Ÿæ–¹ä¾¿åœ°ç»™ä¸€ä¸ªé˜»å¡çš„ä»»åŠ¡åˆ†é…å®ƒè‡ªå·±çš„çº¿ç¨‹ï¼Œè€Œä¸ä¼šå¦¨ç¢å…¶ä»–ä»»åŠ¡å’Œèµ„æºã€‚</li><li>å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆ<code>Schedulers.parallel()</code>ï¼‰ï¼Œæ‰€åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°ä¸ CPU ä¸ªæ•°ç›¸åŒã€‚</li></ul><p><code>Schedulers</code> ç±»å·²ç»é¢„å…ˆåˆ›å»ºäº†å‡ ç§å¸¸ç”¨çš„çº¿ç¨‹æ± ï¼šä½¿ç”¨ <code>single()</code>ã€<code>elastic()</code> å’Œ <code>parallel()</code> æ–¹æ³•å¯ä»¥åˆ†åˆ«ä½¿ç”¨å†…ç½®çš„å•çº¿ç¨‹ã€å¼¹æ€§çº¿ç¨‹æ± å’Œå›ºå®šå¤§å°çº¿ç¨‹æ± ã€‚å¦‚æœæƒ³åˆ›å»ºæ–°çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥ä½¿ç”¨ <code>newSingle()</code>ã€<code>newElastic()</code> å’Œ <code>newParallel()</code> æ–¹æ³•ã€‚</p><p><code>Executors</code> æä¾›çš„å‡ ç§çº¿ç¨‹æ± åœ¨ Reactor ä¸­éƒ½æ”¯æŒï¼š</p><ul><li><code>Schedulers.single()</code> å’Œ <code>Schedulers.newSingle()</code> å¯¹åº” <code>Executors.newSingleThreadExecutor()</code>;</li><li><code>Schedulers.elastic()</code> å’Œ <code>Schedulers.newElastic()</code> å¯¹åº” <code>Executors.newCachedThreadPool()</code>;</li><li><code>Schedulers.parallel()</code> å’Œ <code>Schedulers.newParallel()</code> å¯¹åº” <code>Executors.newFixedThreadPool()</code>;</li></ul><h3 id=åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨>åŒ…è£…ä¸€ä¸ªåŒæ­¥é˜»å¡çš„è°ƒç”¨</h3><p>å¾ˆå¤šæ—¶å€™ï¼Œä¿¡æ¯æºæ˜¯åŒæ­¥å’Œé˜»å¡ã€‚åœ¨ Reactor ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Mono</span><span class=p>.</span><span class=na>fromCallable</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=cm>/* make a remote synchronous call */</span><span class=w> </span><span class=c1>// 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>.</span><span class=na>subscribeOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>boundedElastic</span><span class=p>());</span><span class=w> </span><span class=c1>// 3</span><span class=w>
</span></span></span></code></pre></div><ol><li>ä½¿ç”¨ <code>fromCallable</code> ç”Ÿæˆä¸€ä¸ª <code>Mono</code>;</li><li>è¿”å›åŒæ­¥é˜»å¡çš„èµ„æºï¼›ï¼ˆæ¯”å¦‚é€šè¿‡ http è¯·æ±‚æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼‰</li><li>ä½¿ç”¨ <code>Schedulers.elastic()</code> ç¡®ä¿æ¯ä¸ªè®¢é˜…è¿è¡Œåœ¨ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹ä¸Šã€‚</li></ol><h3 id=åˆ‡æ¢è°ƒåº¦å™¨>åˆ‡æ¢è°ƒåº¦å™¨</h3><p>Reactor æä¾›äº†ä¸¤ç§åœ¨å“åº”å¼é“¾ä¸­è°ƒæ•´è°ƒåº¦å™¨ Scheduler çš„æ–¹æ³•ï¼š<code>publishOn</code> å’Œ <code>subcribeOn</code>ã€‚å®ƒä»¬éƒ½æ¥å—ä¸€ä¸ª <code>Scheduler</code> ä½œä¸ºå‚æ•°ï¼Œèƒ½å¤Ÿæ”¹å˜è°ƒåº¦å™¨ã€‚ä½†æ˜¯ <code>publishOn</code> åœ¨é“¾ä¸­å‡ºç°çš„ä½ç½®æ˜¯æœ‰è®²ç©¶çš„ï¼Œè€Œ <code>subscribeOn</code> å°±æ— æ‰€è°“ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testScheduling</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Flux</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>log</span><span class=p>()</span><span class=w> </span><span class=c1>// 1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>publishOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>elastic</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// .log() // 2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>publishOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>parallel</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;int: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// .log() // 3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribeOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>single</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>5000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><ol><li>åªä¿ç•™è¿™ä¸ª <code>log()</code> çš„è¯ï¼Œæºå¤´æ•°æ®æµæ˜¯æ‰§è¡Œåœ¨ <code>single</code> çº¿ç¨‹æ± ä¸Šçš„ã€‚</li></ol><p><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler1.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler1.webp alt=scheduler1></a></div></p><ol start=2><li>åªä¿ç•™è¿™ä¸ª <code>log()</code> çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>publishOn</code> ä¹‹åçš„æ•°æ®æµæ˜¯åœ¨ <code>elastic</code> çº¿ç¨‹æ± ä¸Šæ‰§è¡Œçš„ã€‚</li></ol><p><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler2.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler2.webp alt=scheduler2></a></div></p><ol start=3><li>åªä¿ç•™è¿™ä¸ª <code>log()</code> çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ<code>publishOn</code> ä¹‹åçš„æ•°æ®æµåˆ‡æ¢åˆ°äº† <code>parallel</code> çº¿ç¨‹æ± ä¸Šæ‰§è¡Œã€‚</li></ol><p><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler3.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler3.webp alt=scheduler3></a></div></p><p>é€šè¿‡ä»¥ä¸Š <code>log()</code> çš„è¾“å‡ºï¼Œèƒ½æ€»ç»“å‡ºä»¥ä¸‹æ“ä½œé“¾ï¼š</p><p><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler4.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/scheduler4.webp alt=scheduler4></a></div></p><ul><li><code>publishOn</code> <strong>ä¼šå½±å“é“¾ä¸­ä¹‹åçš„æ“ä½œç¬¦</strong>ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ª <code>publishOn</code> è°ƒæ•´è°ƒåº¦å™¨ä¸º <code>el</code>asticï¼Œåˆ™ <code>filter</code> çš„å¤„ç†æ˜¯åœ¨å¼¹æ€§çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ï¼›åŒç†ï¼Œ<code>doOnNext</code> æ˜¯åœ¨ parallel çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ï¼›</li><li><code>subscribeOn</code> <strong>æ— è®ºå‡ºç°åœ¨ä»€ä¹ˆä½ç½®ï¼Œåªå½±å“æºå¤´çš„æ‰§è¡Œç¯å¢ƒ</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>map</code> æ–¹æ³•æ˜¯æ‰§è¡Œåœ¨å•çº¿ç¨‹ä¸­çš„ï¼Œç›´è‡³è¢«ç¬¬ä¸€ä¸ª <code>publishOn</code> åˆ‡æ¢è°ƒåº¦å™¨ã€‚</li></ul><h3 id=å¹¶è¡Œæ‰§è¡Œ>å¹¶è¡Œæ‰§è¡Œ</h3><p>å¯¹äºä¸€äº›èƒ½å¤Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­é¡ºåºå¤„ç†çš„ä»»åŠ¡ï¼Œå³ä½¿è°ƒåº¦åˆ° ParallelScheduler ä¸Šï¼Œé€šå¸¸ä¹Ÿåªç”±ä¸€ä¸ª Worker æ¥æ‰§è¡Œï¼Œ
æ¯”å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testParallelFlux</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Flux</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>publishOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>parallel</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>log</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>12:20:51.189 [main] INFO reactor.Flux.PublishOn.1 - | onSubscribe([Fuseable] FluxPublishOn.PublishOnSubscriber)
</span></span><span class=line><span class=cl>12:20:51.191 [main] INFO reactor.Flux.PublishOn.1 - | request(unbounded)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(1)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(2)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(3)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(4)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(5)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(6)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(7)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(8)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(9)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onNext(10)
</span></span><span class=line><span class=cl>12:20:51.205 [parallel-1] INFO reactor.Flux.PublishOn.1 - | onComplete()
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€äº›ä»»åŠ¡èƒ½å¤Ÿ &ldquo;å‡åŒ€&rdquo; åˆ†å¸ƒåœ¨ä¸åŒçš„å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå°±éœ€è¦ç”¨åˆ° <code>ParallelFlux</code>ã€‚
ä½ å¯ä»¥å¯¹ä»»åŠ¡ <code>Flux</code> ä½¿ç”¨ <code>parallel()</code> æ“ä½œç¬¦æ¥å¾—åˆ°ä¸€ä¸ª <code>ParallelFlux</code>ã€‚ä¸è¿‡å®ƒæœ¬èº«å¹¶ä¸ä¼šè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œè€Œæ˜¯å°†è´Ÿè½½åˆ’åˆ†åˆ°å¤šä¸ªæ‰§è¡Œ &ldquo;è½¨é“&rdquo; ä¸Šï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œè½¨é“ä¸ªæ•°ä¸ CPU æ ¸å¿ƒæ•°ç›¸åŒï¼‰ã€‚</p><p>ä¸ºäº†é…ç½® <code>ParallelFlux</code> å¦‚ä½•å¹¶è¡Œåœ°æ‰§è¡Œæ¯ä¸€ä¸ªè½¨é“ï¼Œéœ€è¦ä½¿ç”¨ <code>runOn(Scheduler)</code>ï¼Œ<code>Schedulers.parallel</code> æ˜¯æ¯”è¾ƒæ¨èçš„ä¸“é—¨ç”¨äºå¹¶è¡Œå¤„ç†çš„è°ƒåº¦å™¨ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>testParallelFlux</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Flux</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>parallel</span><span class=p>(</span><span class=n>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>runOn</span><span class=p>(</span><span class=n>Schedulers</span><span class=p>.</span><span class=na>parallel</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>log</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>subscribe</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>TimeUnit</span><span class=p>.</span><span class=na>SECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>12:32:57.483 [main] INFO reactor.Parallel.RunOn.1 - onSubscribe([Fuseable] FluxPublishOn.PublishOnSubscriber)
</span></span><span class=line><span class=cl>12:32:57.485 [main] INFO reactor.Parallel.RunOn.1 - request(unbounded)
</span></span><span class=line><span class=cl>12:32:57.497 [main] INFO reactor.Parallel.RunOn.1 - onSubscribe([Fuseable] FluxPublishOn.PublishOnSubscriber)
</span></span><span class=line><span class=cl>12:32:57.497 [main] INFO reactor.Parallel.RunOn.1 - request(unbounded)
</span></span><span class=line><span class=cl>12:32:57.497 [main] INFO reactor.Parallel.RunOn.1 - onSubscribe([Fuseable] FluxPublishOn.PublishOnSubscriber)
</span></span><span class=line><span class=cl>12:32:57.497 [main] INFO reactor.Parallel.RunOn.1 - request(unbounded)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-1] INFO reactor.Parallel.RunOn.1 - onNext(1)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-2] INFO reactor.Parallel.RunOn.1 - onNext(2)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-1] INFO reactor.Parallel.RunOn.1 - onNext(4)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-2] INFO reactor.Parallel.RunOn.1 - onNext(5)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-3] INFO reactor.Parallel.RunOn.1 - onNext(3)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-2] INFO reactor.Parallel.RunOn.1 - onNext(8)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-1] INFO reactor.Parallel.RunOn.1 - onNext(7)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-3] INFO reactor.Parallel.RunOn.1 - onNext(6)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-1] INFO reactor.Parallel.RunOn.1 - onNext(10)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-3] INFO reactor.Parallel.RunOn.1 - onNext(9)
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-1] INFO reactor.Parallel.RunOn.1 - onComplete()
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-2] INFO reactor.Parallel.RunOn.1 - onComplete()
</span></span><span class=line><span class=cl>12:32:57.498 [parallel-3] INFO reactor.Parallel.RunOn.1 - onComplete()
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå„ä¸ªå…ƒç´ çš„ <code>OnNext</code>" å‡åŒ€ &ldquo;åˆ†å¸ƒæ‰§è¡Œåœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸Šï¼Œæœ€åæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„<code>onComplete</code> äº‹ä»¶ã€‚</p><p><div class="notice notice-warning"><div class=notice-title><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 576 512" fill="hsl(0, 65%, 65%)"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6.0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"/></svg></div><p><code>Schedulers.elastic()</code> å­˜åœ¨å¯èƒ½ä¼šåˆ›å»ºè¿‡å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œä¸åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚è¯¥æ–¹æ³•å·²ç»è¢«æ ‡è®°ä¸ºè¿‡æ—¶ï¼Œå¹¶ä¸”ä¼šåœ¨ reactor-core3.5 ç‰ˆæœ¬ä¸­åˆ é™¤ã€‚å–è€Œä»£ä¹‹åº”è¯¥ä½¿ç”¨ <code>Schedulers.boundedElastic()</code> æœ‰ç•Œå¼¹æ€§çº¿ç¨‹æ± ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸º CPU å¯ç”¨æ ¸å¿ƒæ•° * 10ã€‚</p></div><br></p><h2 id=hot-vs-cold>Hot vs Cold</h2><p>æ— è®ºæ˜¯ <code>Flux</code> è¿˜æ˜¯ <code>Mono</code>ï¼Œéƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šè®¢é˜…å‰ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚å½“æˆ‘ä»¬ &ldquo;åˆ›å»º&rdquo; äº†ä¸€ä¸ª <code>Flux</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªæ˜¯ &ldquo;å£°æ˜&rdquo;/&ldquo;ç»„è£…&rdquo; äº†å®ƒï¼Œä½†æ˜¯å¦‚æœä¸è°ƒç”¨ <code>subscribe</code> æ¥è®¢é˜…å®ƒï¼Œå®ƒå°±ä¸ä¼šå¼€å§‹å‘å‡ºå…ƒç´ ã€‚</p><p>æˆ‘ä»¬å‰é¢å¸¸ç”¨çš„ <code>Mono.just</code> å°±å±äº &ldquo;å†·&rdquo; çš„å‘å¸ƒè€…ã€‚</p><h3 id=å†·åºåˆ—>å†·åºåˆ—</h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç™»é™† B ç«™æ‰“å¼€ä¸€ä¸ªå–œæ¬¢çš„è§†é¢‘ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶é—´å¼€å§‹è§‚çœ‹ï¼Œä¸æ­¤åŒæ—¶ï¼Œå¯èƒ½æœ‰å‡ ç™¾ä¸ªäººåœ¨ä¸åŒçš„åœ°æ–¹å’Œä½ çœ‹åŒä¸€ä¸ªè§†é¢‘ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„æ•°æ®æµã€‚å¯èƒ½æˆ‘å·²ç»çœ‹åˆ°ä¸€åŠäº†ï¼Œåˆ«äººæ‰åˆšåˆšå¼€å§‹çœ‹ã€‚B ç«™çš„è§†é¢‘æ’­æ”¾å°±åƒæ˜¯ä¸€ä¸ª &ldquo;å†·çš„å‘å¸ƒè€…&rdquo;ã€‚</p><blockquote><p>å†·å‘å¸ƒè€…ä¸ä¼šäº§ç”Ÿä»»ä½•æ•°æ®é™¤éè‡³å°‘æœ‰ä¸€ä¸ªäººè®¢é˜…å®ƒã€‚å¹¶ä¸”å®ƒä¼šä¸ºæ¯ä¸ªè®¢é˜…è€…åˆ›å»ºæ–°çš„æ•°æ®ã€‚</p></blockquote><p>æˆ‘ä»¬æŠŠè¿™ä¸ªæ–¹æ³•å½“ä½œè·å–è§†é¢‘çš„æµæ•°æ®</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getVideo</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Got the video streaming request&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;scene 1&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;scene 2&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;scene 3&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;scene 4&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;scene 5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>videoFlux å®ç°å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æ¯é—´éš”ä¸€ç§’æ’­æ”¾ä¸€ä¸ªç”»é¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>videoFlux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>fromStream</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getVideo</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>delayElements</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Tom are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>4000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Jerry are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 2
</span></span><span class=line><span class=cl>Tom are watching scene 3
</span></span><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 4
</span></span><span class=line><span class=cl>Jerry are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 5
</span></span><span class=line><span class=cl>Jerry are watching scene 2
</span></span><span class=line><span class=cl>Jerry are watching scene 3
</span></span><span class=line><span class=cl>Jerry are watching scene 4
</span></span><span class=line><span class=cl>Jerry are watching scene 5
</span></span></code></pre></div><p>æˆ‘ä»¬å‘ç°ï¼Œ&ldquo;Got the video streaming request&rdquo; è¾“å‡ºäº†ä¸¤æ¬¡ï¼Œè¯´æ˜æ¯æ¬¡æ–°çš„è®¢é˜…éƒ½ä¼šè§¦å‘ <code>getVideo</code> è¯·æ±‚ï¼ŒTom æ¯” Jerry å…ˆå¼€å§‹çœ‹è§†é¢‘ï¼Œå½“ Jerry å¼€å§‹çœ‹è§†é¢‘æ—¶ï¼ŒTom å·²ç»çœ‹å®Œäº† 3 ä¸ªç”»é¢ï¼ŒTom å’Œ Jerry åœ¨å¹¶è¡Œåœ°çœ‹åŒä¸€ä¸ªè§†é¢‘ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„ç”»é¢ã€‚Jerry å¹¶ä¸ä¼šå› ä¸ºå¼€å§‹æ—¶é—´æ™šè€Œé”™è¿‡ä»»ä½•ç”»é¢ã€‚</p><h3 id=çƒ­åºåˆ—>çƒ­åºåˆ—</h3><p>æƒ³è±¡æœ‰ä¸€ä¸ªç›´æ’­é—´ï¼Œå®ƒä¸å…³å¿ƒæ˜¯å¦æœ‰äººçœŸçš„åœ¨çœ‹ï¼Œä¸€ç›´æŒç»­åœ°æ’­æ”¾è§†é¢‘æµï¼Œç”¨æˆ·å¯ä»¥åœ¨å®ƒå¼€æ’­æœŸé—´ä»»æ„æ—¶é—´æ‰“å¼€ï¼Œå¹¶ä¸”ç›´æ’­é—´å†…çš„æ‰€æœ‰ç”¨æˆ·åœ¨åŒä¸€æ—¶åˆ»éƒ½çœ‹åˆ°åŒæ ·çš„ç”»é¢ï¼ˆæ•°æ®ï¼‰ï¼Œå¦‚æœæœ‰äººè¿›æ¥æ™šäº†ï¼Œå°±åªèƒ½é”™è¿‡ä¹‹å‰çš„ç‰‡æ®µã€‚ç›´æ’­é—´å°±åƒä¸€ä¸ª &ldquo;çƒ­çš„å‘å¸ƒè€…&rdquo;ã€‚</p><h4 id=share>share</h4><p>è¿˜æ˜¯ä¹‹å‰çš„ videoFluxï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ª <code>share</code>ï¼Œè®©è¿™ä¸ª <code>Flux</code>&rdquo; å˜ &ldquo;æˆä¸€ä¸ªç›´æ’­é—´ã€‚<code>share</code> æŠŠå†·åºåˆ—è½¬æ¢æˆäº†å¯¹å¤šä¸ªè®¢é˜…è€…å¹¿æ’­æ•°æ®çš„çƒ­åºåˆ—ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æ¯é—´éš”ä¸€ç§’æ’­æ”¾ä¸€ä¸ªç”»é¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>videoFlux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>fromStream</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getVideo</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>delayElements</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>share</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Tom are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>4000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Jerry are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 2
</span></span><span class=line><span class=cl>Tom are watching scene 3
</span></span><span class=line><span class=cl>Tom are watching scene 4
</span></span><span class=line><span class=cl>Jerry are watching scene 4
</span></span><span class=line><span class=cl>Tom are watching scene 5
</span></span><span class=line><span class=cl>Jerry are watching scene 5
</span></span></code></pre></div><p>ä»è¾“å‡ºæ¥çœ‹ï¼ŒJerry å› ä¸ºæ¥æ™šäº†ï¼Œé”™è¿‡äº†å‰é¢ 3 ç§’çš„ç”»é¢ï¼Œä½†ä»–èƒ½å’Œ Tom ä¸€æ ·è§‚çœ‹æœ€æ–°çš„ç”»é¢ã€‚</p><p>å¦‚æœç¬¬äºŒä¸ªè®¢é˜…è€…åŠ å…¥æ—¶ï¼Œæ•°æ®å·²ç»å‘é€å®Œæˆäº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè®¢é˜…ä¼šè®©åºåˆ—é‡å¤å‘é€æµç¨‹ï¼Œå°±åƒç”µå½±é™¢ä¸­ï¼Œä¸€éƒ¨å½±ç‰‡æ”¾æ˜ å®Œäº†ï¼Œè¿˜ä¼šæœ‰åç»­çš„æ”¾æ˜ ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æ¯é—´éš”ä¸€ç§’æ’­æ”¾ä¸€ä¸ªç”»é¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>videoFlux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>fromStream</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getVideo</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>delayElements</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>share</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Tom are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Tom çœ‹å®Œç”µå½±</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>6000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Jerry are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 2
</span></span><span class=line><span class=cl>Tom are watching scene 3
</span></span><span class=line><span class=cl>Tom are watching scene 4
</span></span><span class=line><span class=cl>Tom are watching scene 5
</span></span><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Jerry are watching scene 1
</span></span><span class=line><span class=cl>Jerry are watching scene 2
</span></span><span class=line><span class=cl>Jerry are watching scene 3
</span></span><span class=line><span class=cl>Jerry are watching scene 4
</span></span><span class=line><span class=cl>Jerry are watching scene 5
</span></span></code></pre></div><h4 id=cache>cache</h4><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³è®©åºåˆ—é‡å¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>cache</code>ï¼Œå®ƒä¼šç¼“å­˜å†å²æ•°æ®å¹¶å¹¿æ’­ç»™å¤šä¸ªè®¢é˜…è€…ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// æ¯é—´éš”ä¸€ç§’æ’­æ”¾ä¸€ä¸ªç”»é¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Flux</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>videoFlux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Flux</span><span class=p>.</span><span class=na>fromStream</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>getVideo</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>delayElements</span><span class=p>(</span><span class=n>Duration</span><span class=p>.</span><span class=na>ofSeconds</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>cache</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Tom are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=n>6000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>videoFlux</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>scene</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Jerry are watching &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>scene</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 2
</span></span><span class=line><span class=cl>Tom are watching scene 3
</span></span><span class=line><span class=cl>Tom are watching scene 4
</span></span><span class=line><span class=cl>Tom are watching scene 5
</span></span><span class=line><span class=cl>Jerry are watching scene 1
</span></span><span class=line><span class=cl>Jerry are watching scene 2
</span></span><span class=line><span class=cl>Jerry are watching scene 3
</span></span><span class=line><span class=cl>Jerry are watching scene 4
</span></span><span class=line><span class=cl>Jerry are watching scene 5
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>getVideo()</code> åªè°ƒç”¨äº†ä¸€æ¬¡ï¼Œä½†æ˜¯ Jerry ä»ç„¶å¯ä»¥è§‚çœ‹çš„æ‰€æœ‰çš„ç”»é¢ï¼Œcache ä¸ºä»¥åçš„è®¢é˜…è€…ç¼“å­˜äº†æ‰€æœ‰çš„æ•°æ®ã€‚</p><p>å¦‚æœä¸æƒ³ç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>cache(0)</code>ã€‚</p><p>è¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Got the video streaming request
</span></span><span class=line><span class=cl>Tom are watching scene 1
</span></span><span class=line><span class=cl>Tom are watching scene 2
</span></span><span class=line><span class=cl>Tom are watching scene 3
</span></span><span class=line><span class=cl>Tom are watching scene 4
</span></span><span class=line><span class=cl>Tom are watching scene 5
</span></span></code></pre></div><br><details><summary>æ­¤æ—¶çš„ Jerry</summary><div class=post-img-view><a data-fancybox=gallery href=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/jerry-shock.webp><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/post/jerry-shock.webp alt=jerry-shock></a></div></details><h3 id=æ€»ç»“>æ€»ç»“</h3><ul><li>å†·åºåˆ—ï¼šä¸ç®¡è®¢é˜…è€…åœ¨ä½•æ—¶è®¢é˜…ï¼Œéƒ½èƒ½æ”¶åˆ°æ•°æ®æµä¸­çš„å…¨éƒ¨æ•°æ®ã€‚</li><li>çƒ­åºåˆ—ï¼šçƒ­åºåˆ—æŒç»­äº§ç”Ÿæ•°æ®ï¼Œè®¢é˜…è€…åªèƒ½è·å–åˆ°å…¶è®¢é˜…ä¹‹åçš„æ•°æ®ã€‚</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/spring/>Spring</a>
<a href=/tags/java/>Java</a>
<a href=/tags/spring-webflux/>Spring Webflux</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/dive-into-spring-webflux-5/><div class=article-image><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/kimi-no-na-wa.webp loading=lazy data-key=dive-into-spring-webflux-5 data-hash=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/kimi-no-na-wa.webp></div><div class=article-details><h2 class=article-title>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆäº”ï¼‰</h2></div></a></article><article class=has-image><a href=/post/dive-into-spring-webflux-3/><div class=article-image><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/pink-girl.webp loading=lazy data-key=dive-into-spring-webflux-3 data-hash=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/pink-girl.webp></div><div class=article-details><h2 class=article-title>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆä¸‰ï¼‰</h2></div></a></article><article class=has-image><a href=/post/dive-into-spring-webflux-2/><div class=article-image><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/rem-face-portrait-close.webp loading=lazy data-key=dive-into-spring-webflux-2 data-hash=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/rem-face-portrait-close.webp></div><div class=article-details><h2 class=article-title>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆäºŒï¼‰</h2></div></a></article><article class=has-image><a href=/post/dive-into-spring-webflux-1/><div class=article-image><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/miku-miko-twintails-aqua-eyes-mouse.webp loading=lazy data-key=dive-into-spring-webflux-1 data-hash=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/miku-miko-twintails-aqua-eyes-mouse.webp></div><div class=article-details><h2 class=article-title>å“åº”å¼ç¼–ç¨‹ Spring Webflux è¯¦è§£ï¼ˆä¸€ï¼‰</h2></div></a></article><article class=has-image><a href=/post/winsw-usage/><div class=article-image><img src=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/rem-loli-yukata.webp loading=lazy data-key=winsw-usage data-hash=https://cdn.jsdelivr.net/gh/oopooa/cdn/cover/rem-loli-yukata.webp></div><div class=article-details><h2 class=article-title>WinSW ä½¿ç”¨</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=oopooa/oopooa.github.io data-repo-id=R_kgDOMGuQ6Q data-category=Announcements data-category-id=DIC_kwDOMGuQ6c4CgB01 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 èœ€ICPå¤‡20005474å·-1</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º
ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section><section class=total-count>å‘è¡¨äº† 32 ç¯‡æ–‡ç« ãƒ»
æ€»è®¡ 66.17 k å­—</section><section class=busuanzi-count><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡ <span id=busuanzi_value_site_pv></span> æ¬¡
</span>Â·
<span id=busuanzi_container_site_uv>æ€»è®¿å®¢æ•° <span id=busuanzi_value_site_uv></span> äºº</span></section><section class=running-time>æœ¬åšå®¢å·²ç¨³å®šè¿è¡Œ ğŸ§¡
<span id=runningdays class=running-days></span></section></footer><script>runningTime(),setInterval(()=>{runningTime()},1e3);function runningTime(){let t="2020-02-02 22:22:22";t=new Date(t.replace(/-/g,"/"));let n=new Date,e=n.getTime()-t.getTime(),s=Math.floor(e/(1e3*60*60*24)),o=Math.floor(e%(1e3*60*60*24)/(1e3*60*60)),i=Math.floor(e%(1e3*60*60)/(1e3*60)),a=Math.floor(e%(1e3*60*60*24)%(1e3*60*60)%(1e3*60)/1e3),r=`${s} å¤© ${zeroize(o)} å°æ—¶ ${zeroize(i)} åˆ†é’Ÿ ${zeroize(a)} ç§’`;document.querySelector("#runningdays").innerHTML=r}function zeroize(e){return e<10?"0"+e:e}</script><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://cdn.jsdelivr.net/gh/oopooa/cdn/css/opoa-font.css",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>